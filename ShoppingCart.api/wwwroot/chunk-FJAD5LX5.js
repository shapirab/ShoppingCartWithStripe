import{a as L}from"./chunk-H5S3IECU.js";import{b as j,f as A}from"./chunk-YYHLADZH.js";import{b as _,k,na as T,qa as O}from"./chunk-V5SENJY6.js";import{Gc as x,Ja as h,Jb as E,Ob as n,Pb as i,Pc as D,Qb as U,Vc as M,ca as v,fb as d,gb as b,ha as I,jc as a,kc as u,lc as P,rb as S,uc as c,vc as s,w as g,xb as w}from"./chunk-RYDPFYJP.js";var q="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var B=(o=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)t+=q[e[o]&63];return t};var f=class{id=B();items=[];deliveryMethodId;paymentIntentId;clientSecret};var y=class o{constructor(t){this.http=t}baseUrl=O.apiUrl;cart=h(null);selectedDelivery=h(null);itemCount=x(()=>this.cart()?.items.reduce((t,e)=>t+e.quantity,0));totals=x(()=>{let t=this.selectedDelivery(),e=this.cart()?.items.reduce((m,p)=>m+p.price*p.quantity,0),r=t?t.price:0,l=0;return e?{subtotal:e,shipping:r,discount:l,total:e+r-l}:null});getCart(t){return this.http.get(`${this.baseUrl}/cart?id=${t}`).pipe(g(e=>(this.cart.set(e),e)))}setCart(t){return this.http.post(`${this.baseUrl}/cart`,t).subscribe({next:e=>this.cart.set(e)})}deleteCart(){this.http.delete(`${this.baseUrl}/cart?id=${this.cart()?.id}`).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addItemToCart(t,e=1){let r=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),r.items=this.createOrUpdateItem(r.items,t,e),this.setCart(r)}removeItemFromCart(t,e=1){let r=this.cart();if(!r)return;let l=r.items.findIndex(m=>m.productId===t);l!==-1&&(r.items[l].quantity>e?r.items[l].quantity-=e:r.items.splice(l,1),r.items.length===0?this.deleteCart():this.setCart(r))}createOrUpdateItem(t,e,r){let l=t.findIndex(m=>m.productId===e.productId);return l===-1?(e.quantity=r,t.push(e)):t[l].quantity+=r,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,imageUrl:t.imageUrl,brand:t.productBrand,type:t.productType}}isProduct(t){return t.id!==void 0}createCart(){let t=new f;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(e){return new(e||o)(I(_))};static \u0275prov=v({token:o,factory:o.\u0275fac,providedIn:"root"})};function $(o,t){o&1&&(n(0,"div",10)(1,"button",17),a(2,"Checkout"),i(),n(3,"button",18),a(4,"Continue Shopping"),i()())}var F=class o{constructor(t,e){this.cartService=t;this.location=e}static \u0275fac=function(e){return new(e||o)(b(y),b(D))};static \u0275cmp=S({type:o,selectors:[["app-order-summary"]],decls:41,vars:13,consts:[[1,"mx-auto","max-w-4xl","flex-1","space-y-6","w-full"],[1,"space-y-4","rounded-lg","border","p-4","border-gray-200","bg-white","shadow-sm"],[1,"text-xl","font-semibold"],[1,"space-y-4"],[1,"space-y-2"],[1,"flex","items-center","justify-between","gap-4"],[1,"font-medium","text-gray-500"],[1,"font-medium","text-gray-900"],[1,"font-medium","text-green-500"],[1,"flex","items-center","justify-between","gap-4","border-t","border-gray-200","pt-2"],[1,"flex","flex-col","gap-2"],[1,"space-y-4","rounded-lg","border","border-gray-200","bg-white","shadow-sm"],[1,"space-y-2","flex","flex-col","p-2"],[1,"mb-2","block","text-sm","font-medium"],["appearance","outline"],["type","text","matInput",""],["mat-flat-button",""],["mat-flat-button","","routerLink","/checkout"],["mat-button","","routerLink","/shop"]],template:function(e,r){if(e&1&&(n(0,"div",0)(1,"div",1)(2,"p",2),a(3,"Order Summary"),i(),n(4,"div",3)(5,"div",4)(6,"dl",5)(7,"dt",6),a(8,"Subtotal"),i(),n(9,"dd",7),a(10),c(11,"currency"),i()(),n(12,"dl",5)(13,"dt",6),a(14,"Discount"),i(),n(15,"dd",8),a(16),c(17,"currency"),i()(),n(18,"dl",5)(19,"dt",6),a(20,"Delivery fee"),i(),n(21,"dd",7),a(22),c(23,"currency"),i()()(),n(24,"dl",9)(25,"dt",6),a(26,"Total"),i(),n(27,"dd",7),a(28),c(29,"currency"),i()()(),w(30,$,5,0,"div",10),i(),n(31,"div",11)(32,"form",12)(33,"label",13),a(34,"Do you have a voucher code?"),i(),n(35,"mat-form-field",14)(36,"mat-label"),a(37,"Voucher code"),i(),U(38,"input",15),i(),n(39,"button",16),a(40,"Apply Code"),i()()()()),e&2){let l,m,p,C;d(10),u(s(11,5,(l=r.cartService.totals())==null?null:l.subtotal)),d(6),P("-",s(17,7,(m=r.cartService.totals())==null?null:m.discount),""),d(6),u(s(23,9,(p=r.cartService.totals())==null?null:p.shipping)),d(6),u(s(29,11,(C=r.cartService.totals())==null?null:C.total)),d(2),E(r.location.path()!=="/checkout"?30:-1)}},dependencies:[T,A,j,L,k,M],encapsulation:2})};export{y as a,F as b};
